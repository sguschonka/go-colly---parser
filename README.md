
# Wikipedia Links Scraper

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ Go –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Å—ã–ª–æ–∫ —Å —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –í–∏–∫–∏–ø–µ–¥–∏–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Excel-—Ñ–∞–π–ª `scraped_links.xlsx`, –∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–¥–µ—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ —Ñ–∞–π–ª `parser.log`.

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É [Colly](https://github.com/gocolly/colly) –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü.
- –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
- –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å—Å—ã–ª–∫–∏ —Å –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
- –§–æ—Ä–º–∏—Ä—É–µ—Ç Excel-—Ç–∞–±–ª–∏—Ü—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   go mod init scraper
   go get github.com/gocolly/colly/v2
   go get github.com/xuri/excelize/v2
   ```

2. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   go run main.go
   ```

3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª `scraped_links.xlsx`.

## üì¶ –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

- `parser.log` ‚Äî –ª–æ–≥–∏ —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞.
- `scraped_links.xlsx` ‚Äî Excel-—Ñ–∞–π–ª —Å —Ç—Ä–µ–º—è –∫–æ–ª–æ–Ω–∫–∞–º–∏:
  - Page URL
  - Page Title
  - Link URL

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

- –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–¥–∞–µ—Ç—Å—è –≤ —Å–ª–∞–π—Å–µ `urls` –≤ —Ñ–∞–π–ª–µ `main.go`.
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Colly (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∑–∞–¥–µ—Ä–∂–∫–∞) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `c.Limit()`.


---

* –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
![image](https://github.com/user-attachments/assets/b34f38a8-d11a-45c6-8c28-6fff7dce12ad)

---

## –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞

### 1Ô∏è‚É£ –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫

```go
import (
	"fmt"
	"io"
	"log"
	"os"
	"sync"
	"time"

	"github.com/gocolly/colly/v2"
	"github.com/xuri/excelize/v2"
)
```

* **fmt** ‚Äî –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞.
* **io, os** ‚Äî –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ (–ª–æ–≥–∞–º–∏).
* **log** ‚Äî –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
* **sync** ‚Äî –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤.
* **time** ‚Äî –¥–ª—è –∑–∞–¥–∞–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.
* **colly** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–∞–π—Ç–æ–≤.
* **excelize** ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Excel-—Ñ–∞–π–ª–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.

---

### 2Ô∏è‚É£ –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫

```go
type Link struct {
	PageURL   string
	PageTitle string
	LinkURL   string
}
```

* –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `Link` –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É: —Å URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ —Å–∞–º–æ–π —Å—Å—ã–ª–∫–æ–π.

---

### 3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```go
file, err := os.OpenFile("parser.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
...
mw := io.MultiWriter(os.Stdout, file)
logger := log.New(mw, "scraper: ", log.LstdFlags)
```

* –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ —Ñ–∞–π–ª `parser.log` –∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —á–µ—Ä–µ–∑ `MultiWriter`.
* –ï—Å–ª–∏ –ª–æ–≥-—Ñ–∞–π–ª –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

---

### 4Ô∏è‚É£ –ó–∞–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ URL –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

```go
urls := []string{
	"https://en.wikipedia.org/wiki/Dota_2",
	...
}
```

* –ó–¥–µ—Å—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –í–∏–∫–∏–ø–µ–¥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å.

---

### 5Ô∏è‚É£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Colly

```go
c := colly.NewCollector(
	colly.Async(true),
	colly.UserAgent("..."),
)
```

* –í–∫–ª—é—á–µ–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
* p.s. –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ colly —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ –≥–æ—Ä—É—Ç–∏–Ω, –≤—Å–µ —á—Ç–æ –Ω—É–∂–Ω–æ - –¥–æ–≤–µ—Ä–∏—Ç—å—Å—è –µ–π
* –£–∫–∞–∑–∞–Ω User-Agent –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.

---

### 6Ô∏è‚É£ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Colly

```go
c.Limit(&colly.LimitRule{
	DomainGlob:  "*",
	Parallelism: 3,
	Delay:       10 * time.Millisecond,
})
```

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π 10 –º—Å –º–µ–∂–¥—É –Ω–∏–º–∏.

---

### 7Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±—â–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

```go
var allLinks []Link
var titles = make(map[string]string)
var mu sync.Mutex
```

* `allLinks` ‚Äî —Å–ª–∞–π—Å –¥–ª—è –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.
* `titles` ‚Äî –∫–∞—Ä—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü (–∫–ª—é—á ‚Äî URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã).
* `mu` ‚Äî –º—å—é—Ç–µ–∫—Å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º –ø—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏.

---

### 8Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Colly

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```go
c.OnRequest(func(r *colly.Request) {
	logger.Println("–ü–æ—Å–µ—â–∞–µ–º:", r.URL)
})
```

#### –°–±–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü:

```go
c.OnHTML("h1#firstHeading", func(e *colly.HTMLElement) {
	mu.Lock()
	titles[e.Request.URL.String()] = e.ChildText("i")
	mu.Unlock()
	logger.Println("–ó–∞–≥–æ–ª–æ–≤–æ–∫:", e.ChildText("i"))
})
```

* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—â–µ—Ç—Å—è –ø–æ `h1#firstHeading i` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫–∞—Ä—Ç—É.

#### –°–±–æ—Ä –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:

```go
c.OnHTML("div.mw-body-content a", func(h *colly.HTMLElement) {
	link := h.Attr("href")
	absoluteLink := h.Request.AbsoluteURL(link)
	mu.Lock()
	if absoluteLink != "" {
		allLinks = append(allLinks, Link{
			PageURL:   h.Request.URL.String(),
			LinkURL:   absoluteLink,
			PageTitle: titles[h.Request.URL.String()],
		})
	}
	mu.Unlock()
})
```

* –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∏ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —Å –∫–ª–∞—Å—Å–æ–º `mw-body-content`.
* –ü—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ URL –∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–ª–∞–π—Å `allLinks`.

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:

```go
c.OnError(func(r *colly.Response, err error) {
	fmt.Println("–û—à–∏–±–∫–∞:", err)
})
```

---

### 9Ô∏è‚É£ –°—Ç–∞—Ä—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

```go
for _, url := range urls {
	err := c.Visit(url)
	if err != nil {
		logger.Printf("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å–µ—Ç–∏—Ç—å %s: %v\n", url, err)
	}
}
c.Wait()
```

* –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ `urls` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `Visit`.
* `c.Wait()` –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.

---

### üîü –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–æ–∫

```go
for i, link := range allLinks {
	mu.Lock()
	if title, exists := titles[link.PageURL]; exists {
		allLinks[i].PageTitle = title
	} else {
		allLinks[i].PageTitle = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫"
	}
	mu.Unlock()
}
```

* –ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É `allLinks` –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫", –µ—Å–ª–∏ –µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏.

---

### üî• –í—ã–≤–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Å—ã–ª–æ–∫

```go
logger.Printf("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫: %d", len(allLinks))
```

---

### üìä –°–æ–∑–¥–∞–Ω–∏–µ Excel-—Ñ–∞–π–ª–∞

```go
f := excelize.NewFile()
defer f.Close()
sheet := "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã"
f.SetSheetName("Sheet1", sheet)
```

* –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ñ–∞–π–ª Excel –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –ª–∏—Å—Ç.

---

### üìù –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ Excel-—Ç–∞–±–ª–∏—Ü—ã

1. –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤:

```go
f.SetCellValue(sheet, "A1", "Page URL")
f.SetCellValue(sheet, "B1", "Page Title")
f.SetCellValue(sheet, "C1", "Link URL")
```

2. –î–∞–Ω–Ω—ã–µ:

```go
for i, link := range allLinks {
	f.SetCellValue(sheet, fmt.Sprintf("A%d", i+2), link.PageURL)
	f.SetCellValue(sheet, fmt.Sprintf("B%d", i+2), link.PageTitle)
	f.SetCellValue(sheet, fmt.Sprintf("C%d", i+2), link.LinkURL)
}
```

---

### üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Excel-—Ñ–∞–π–ª–∞

```go
if err := f.SaveAs("scraped_links.xlsx"); err != nil {
	logger.Fatalf("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ Excel-—Ñ–∞–π–ª–∞: %v", err)
}
logger.Println("–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω")
```

---
